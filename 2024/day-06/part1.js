const input = [
    ".....................#................#...#.....#.................................................#...........#...................",
    ".............#....#.#.................................#....................................................#.........#............",
    "...........................................#...................................................................#......#...........",
    "....................................................#................#.......#.............#......................................",
    "..........................................#...##.#....................................#....#.........#............................",
    "....................................#.............................................#.......#................#.......###............",
    "..##.......#......................#..#........................................................#...................#...............",
    ".....#...........#..................................#..............#...........#..................................................",
    "..........#..#......#.....#..#........#..................#.............................#...........................##............#",
    "..............................#....#..........#...................................................................................",
    ".......#.#..........................#.........#...##..........................................................#.#....#...#.#......",
    "..............................................................................................................#.........#.........",
    "....................#......#.....#...............................#..#.........#........................#.#.....#..................",
    "......................................##.................#.....................#............#.#.#..............#...............#..",
    "#...........................#..................#.....#..#..#.............#......#.........#........#........#.#.#.................",
    ".......#.............#....................#.................#...#.........#.......#................#......#................#....#.",
    "...............#.................................................#................#..................#..................#.........",
    ".........#....................#..............................#..............#..............#.......#....................#......#..",
    "....................................##.............................................................................#.#............",
    ".....................................................................#...#.#........................#....#....#......#............",
    ".....#...........................#.........#.............................................................................#........",
    "...............#.#.........#...............##..............................................#............#.........................",
    "#..............#....##....#............#...#.#............................#...................................#..#..............#.",
    "........#.........#...........................................................#..............................................#....",
    ".........................................................................................#.......#................................",
    "................................#.........#..........#..#.......................................#..............................#..",
    "........................#.................................................................................##........#.............",
    ".....#.....................#.....................#...#...........#.........................#......................................",
    "....................................................................................................#.............................",
    ".........#...................................#...#................................................................................",
    "..............#............##......#..............#......................................................#.....................#..",
    "..#.......#............................................................................#...#.....................#................",
    "..................#.....................##..#.................#..........#.....#........#.............#............#...........#..",
    "...................................#.....#..............#..#.............................................#.....#......#....#......",
    "......#....#.....................................................#................#...............................#...............",
    "..#.#..................#.......#......#.............#.......#.....................................................................",
    "......##...........................#.................#.....#........................................#.............................",
    "...#......................#...............##......#.......................#..........#.................#.......#.......#..........",
    "...........................#.............................................................#.#................#......#..#...........",
    "..#.............#.....#.........................................................#..........#......................................",
    "...........#.........#..........................................................................#..............#..................",
    ".#.......................................................#.#.......#............................................#.#...............",
    "..........................#....#...............#............................................................#.........#...........",
    ".........................##.........#^.....................................................#......................................",
    "........#.......#.................................................................................................#.......#.......",
    "..........#..................................##..#.......................#.................#....................................#.",
    "...................................#..#.....#.#.............#.....#.................##..............#.............................",
    "...........................................................#.........................................................#......#.....",
    "............#.........................#.........#.................................................................................",
    "................#.........................#...............................#.......................................................",
    ".....................#.......#.................#.#..............#...............#.................................................",
    "...#......................#...............................#.......#.......#..........................................#............",
    ".........#..#............................................................................................#........................",
    "..............................................................................................#.#...........#.........#...........",
    "..#..............#...............#.................................................................#.....#........................",
    "................#..........#.......##..............#..............................#.##......#.....................................",
    ".........#....#.#..................................................................#...................#..........................",
    "#...#............#...............................................................................................................#",
    "........#.....#.#................#.........................#.........#...........................##........................#.#....",
    "......#...#.....................................................................#...........................#.....................",
    "........#.........#.....................#............................................................................#..........#.",
    ".................................................................#....................#.........#..#...#.##.......................",
    "..........#...........................##.......#...................................................................#.#............",
    ".......................................................................................#.................#..#.#...................",
    "............................................................................................#.............#.......................",
    "........................#........................#.................#..........................#...........................#.......",
    ".....................................#......#.................................#..........#........................................",
    "....#...............................#........#............................#............................#..........................",
    "..........#................#.#....................................................................................................",
    "#........................................................................#..........................................#.....#.......",
    ".#....................................#.........#..#.#...................................................#........................",
    "...................#....................#..............#..................#.................................................#.....",
    ".........................................................................#..........................#............#................",
    "........................................................#.................................................................#.......",
    "#...........................................#..............#............................................................#..#......",
    "...............#..............#...............#............................#.......#.............#....#...........................",
    "......#............#.#...........................................................................................#................",
    "..................#..#.......#..............................#.............................#........#.......#.........#...........#",
    "...............#.....................................#......#....................................#..........#................#....",
    ".............................................#...............#...........#........#.............#...#.......................##....",
    ".....#..................#...........#..............#.............#....................................#.........#.................",
    "........................#.......................................................................#...........#.....................",
    ".............................#.....................................................#........##....................................",
    "...........#.................................................................................#.........#....#....#.....#..........",
    ".....#..................................................................................#.....#.............................#....#",
    "..#........#...............#.........................................................#.......#........................#.........#.",
    "..............................................#....................##..............................#..........#.......#.#......#..",
    ".......................#......................................................#........#..........................................",
    "..#.........................................#...........#.........................................................#...............",
    "..........................#.......#...............................................................................................",
    ".........#.....................#..............................................#...............#...................................",
    "..............................................#.........#..........#....#..............#..........................................",
    "......................................#.........#............#........................................................#...#.......",
    "...........................................#.....#..................#.....#..........#...............#...#........................",
    ".......................#........#..........................................................#.......#.........#............#....#..",
    "..........#.....................................................................#...#.......#.......#.........#.....#.............",
    ".............................#..#...............................#....#.................................................#..#.......",
    ".#.............#................##......................................#...#..............................#............#.........",
    "....#.........#....#..................................................................................#...............#.....#.....",
    "......#................................................#.....#.#.......#.......#....................#.............#...............",
    "...............................#..........#........................#.......................................................#.....#",
    "...............#.......................................................................................#......#.......#..#.#.#....",
    "..#....#.........................................................................#...................#....................##......",
    "...........................#......#.................#...#..........................#..............................................",
    "......#..........#...#............#....#..........................................................................................",
    ".......................#......#...............#..#......................#......#........................#........................#",
    ".#............#................................#............#....................#.................................#..............",
    "................#.........#.................###............#..#...............#..............................#...#................",
    "......#..........................#....#............#.................#...................................................#........",
    "..........................#...#.............#........#......................#......................#.#.............#............#.",
    "............................#................#....................#....##.......................#........#..........##.....#......",
    "..............#.#...................#.#.............................................#..........#......#...........................",
    ".....#.........................#...........#...#......................................#......#..........#.#....#.##...............",
    ".............##.##....................................................................#.#..............#.......#.....#..#...#.....",
    "#.......#..................#.........#...................#................#..##...............##...............#..................",
    "..............#....#........#.....#.................................#....#....#...#.......................................#.......",
    "...........................#......#..............................#......................#.........................................",
    ".................#.#..........##................#...#..................................#..............#.....#.................#...",
    "..........................#..............#..#......................#.......................#...........##.........................",
    "..#...................#..........#.......#..........#...............................#.....................#.......................",
    "............#......................#................#....#......................#.................................................",
    "...........................................#........#.........#..........#..................#....#.........#....##................",
    "..........#........................#.#...............#............................................#........#...#.....#............",
    "...............#..........#..........#...#.....#........................#..............#..#.....................##................",
    "...#.......................##.....................#................................................#..#............#..............",
    "....#........#..#...#.#............................#................#................#............................................",
    "...........#....................#.....#.........................#....................#.............#....#.........#...#........##.",
    ".#.....#.................##............#...............................#...............#.......................##.................",
    "..............................#................................#.............................#................#.#.................",
    "............##..............#........#.......#...................#..........................#.............###..#...#............#.",
]

const test = [
    "....#.....",
    ".........#",
    "..........",
    "..#.......",
    ".......#..",
    "..........",
    ".#..^.....",
    "........#.",
    "#.........",
    "......#...",
]

function main() {
    console.log("day 06 part 1...")
    const startingmap = []
    input.forEach(row => {
        startingmap.push(row.split(""))
    })
    // console.log(startingmap)

    let markedMap = new Array(startingmap.length).fill().map(() => new Array(startingmap[0].length).fill("."))
    let isDone = false
    let stepCounter = 0
    let nextPosition = findCurrentGuardPosition(startingmap)
    console.log(nextPosition)
    markedMap = markPosition(markedMap, nextPosition.x, nextPosition.y)


    while (!isDone && stepCounter < 10000) {
        nextPosition = findNextPosition(startingmap, nextPosition)
        if (nextPosition === "done") { isDone = true }
        else {
            console.log(nextPosition)
            markedMap = markPosition(markedMap, nextPosition.x, nextPosition.y)
        }
        stepCounter++
    }
    // console.log(markedMap)
    console.log(countStepsTaken(markedMap))
}

main()

function findCurrentGuardPosition(map) {
    const regex = /(<|>|v|\^)/
    let currentX = null, currentY = null
    map.forEach((row, i) => {
        row.forEach((position, j) => {
            if (regex.test(position)) {
                currentX = j
                currentY = i
            }
        })
    })
    return { x: currentX, y: currentY, direction: findDirection(map[currentY][currentX]) }
}

function findDirection(guard) {
    if (guard === "^") { return "up" }
    if (guard === "v") { return "down" }
    if (guard === ">") { return "right" }
    if (guard === "<") { return "left" }
    return "something went wrong"
}

function move(oldposition, newpostion) {

}

function markPosition(map, x, y) {
    console.log(x + ", " + y)
    const markedMap = [...map]
    markedMap[Number(y)][Number(x)] = "X"
    // console.log(markedMap)
    return markedMap
}

// let testArray = new Array(6).fill().map(() => new Array(6).fill("."))
// console.log(testArray)
// testArray = markPosition(testArray, 1, 2)
// console.log(testArray)
// testArray = markPosition(testArray, "0", "2")
// console.log(testArray)

function findNextPosition(map, currentPosition) {
    let nextX = currentPosition.x
    let nextY = currentPosition.y
    if (currentPosition.direction === 'up') { nextY-- }
    if (currentPosition.direction === 'down') { nextY++ }
    if (currentPosition.direction === 'left') { nextX-- }
    if (currentPosition.direction === 'right') { nextX++ }

    // check if walking off the map
    if (nextX < 0 || nextY < 0 || nextX >= map[0].length || nextY >= map.length) {
        return "done"
    }

    // check for collision
    if (map[nextY][nextX] === "#") {
        let nextDirection = null
        if (currentPosition.direction === 'up') { nextDirection = "right" }
        if (currentPosition.direction === 'down') { nextDirection = "left" }
        if (currentPosition.direction === 'left') { nextDirection = "up" }
        if (currentPosition.direction === 'right') { nextDirection = "down" }
        return { x: currentPosition.x, y: currentPosition.y, direction: nextDirection }
    }

    // return next field
    return { x: nextX, y: nextY, direction: currentPosition.direction }
}

function countStepsTaken(map) {
    let counter = 0
    map.forEach(row => {
        row.forEach(value => {
            if (value === "X") { counter++ }
        })
    })
    return counter
}